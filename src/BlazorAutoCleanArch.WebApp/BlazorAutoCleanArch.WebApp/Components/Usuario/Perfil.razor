@page "/usuario/{Id}/perfil"
@using BlazorAutoCleanArch.Aplicacao.DTOs.Responses
@attribute [Authorize]
@inject NavigationManager NavigationManager
@inject IPlaylistsAppServico PlaylistsAppServico
@attribute [StreamRendering]

<div class="profile-page">

    <!-- Header com foto de perfil e nome -->
    <div class="profile-header bg-gradient p-5">
        <div class="container-fluid px-5">
            <AuthorizeView>
                <div class="row align-items-end">
                    <div class="col-auto">
                        <img src="@GravatarHelper.ObterGravatarUrl(context.User.ObterEmail(), 400)"
                             height="200"
                             width="200"
                             class="profile-image shadow-lg rounded-circle me-2" />
                    </div>
                    <div class="col">
                        <p class="text-white-50 mb-2 small text-uppercase fw-semibold">Perfil</p>
                        <h1 class="display-3 fw-bold text-white mb-3">@context.User.ObterNome()</h1>
                        <p class="text-white-50 mb-0">
                            <span class="fw-semibold">@quantidadePlaylists</span> playlists públicas
                        </p>
                    </div>
                </div>
            </AuthorizeView>
        </div>
    </div>

    <!-- Conteúdo principal -->
    <div class="profile-content bg-dark">
        <div class="container-fluid px-5 py-4">
            <!-- Botão criar playlist -->
            <div class="mb-4">
                <a class="btn btn-primary btn-lg rounded-pill px-4" href="@($"/usuario/{Id}/playlist/nova")">
                    <i class="bi bi-plus-circle me-2"></i>
                    Criar Playlist
                </a>
            </div>

            <!-- Grid de playlists -->
            <div class="playlists-section">
                <h2 class="h4 text-white mb-4">Playlists Públicas</h2>
                @if (playlists == null)
                {
                    <div class="d-flex justify-content-center align-items-center py-5" style="min-height: 200px;">
                        <div class="spinner-grow" style="width: 3rem; height: 3rem;" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                }
                else if (playlists.Count == 0)
                {
                    <div class="text-center text-white-50 py-5">
                        <i class="bi bi-music-note-list fs-1 mb-3"></i>
                        <p>Nenhuma playlist encontrada</p>
                    </div>
                }
                else
                {
                    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 row-cols-xxl-6 g-4">
                        @foreach (var playlist in playlists)
                        {
                            <div class="col">
                                <a href="@($"/playlist/{playlist.Id}")" class="text-decoration-none">
                                    <div class="playlist-card bg-body-secondary rounded-3 p-3 h-100 transition-transform">
                                        <div class="playlist-cover mb-3 position-relative">
                                            <img src="https://picsum.photos/300/300?random=@playlist.Nome"
                                                 alt="@playlist.Nome"
                                                 class="w-100 rounded-2 shadow" />
                                            <div class="play-button position-absolute bottom-0 end-0 m-2 opacity-0 transition-opacity">
                                                <div class="btn btn-primary rounded-circle p-3 shadow">
                                                    <i class="bi bi-play-fill fs-5"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <h3 class="h6 text-white fw-semibold mb-2 text-truncate">
                                            @playlist.Nome
                                        </h3>
                                        <p class="small text-white-50 mb-0 playlist-description">
                                            Teste descrição colocar aqui
                                        </p>
                                    </div>
                                </a>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
    article.px-4 {
        padding: 0 !important;
    }

    .profile-page {
        margin: 0;
        padding: 0;
        width: 100%;
    }

    .profile-header {
        background: linear-gradient(135deg, #512bd4 0%, #8b5cf6 50%, #3b82f6 100%);
        min-height: 340px;
        display: flex;
        align-items: flex-end;
        width: 100%;
    }

    .profile-image {
        width: 232px;
        height: 232px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid rgba(255, 255, 255, 0.2);
    }

    .profile-content {
        min-height: calc(100vh - 340px);
        background: linear-gradient(180deg, rgba(81, 43, 212, 0.15) 0%, #0d1117 20%);
        width: 100%;
    }

    .playlist-card {
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        background-color: #1a1d29 !important;
    }

        .playlist-card:hover {
            background-color: #252a3a !important;
            transform: translateY(-4px);
        }

            .playlist-card:hover .play-button {
                opacity: 1 !important;
            }

    .playlist-cover {
        aspect-ratio: 1;
        overflow: hidden;
    }

        .playlist-cover img {
            object-fit: cover;
            aspect-ratio: 1;
        }

    .playlist-description {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .transition-transform {
        transition: transform 0.2s ease;
    }

    .transition-opacity {
        transition: opacity 0.3s ease;
    }

    .text-white-50 {
        color: rgba(255, 255, 255, 0.7);
    }

    .bg-body-secondary {
        background-color: #1a1d29;
    }

    .btn-primary {
        background: linear-gradient(135deg, #512bd4 0%, #8b5cf6 100%);
        border: none;
    }

        .btn-primary:hover {
            background: linear-gradient(135deg, #6d3aea 0%, #a78bfa 100%);
            transform: scale(1.04);
        }
</style>

@code {
    [Parameter]
    public string Id { get; set; } = string.Empty;

    private int quantidadePlaylists = 0;
    private IReadOnlyList<PlaylistListarResponse>? playlists;

    protected override async Task OnParametersSetAsync()
    {
        await CarregarPlaylistsAsync();
    }

    private async Task CarregarPlaylistsAsync()
    {
        try
        {
			await Task.Delay(5000);
            playlists = await PlaylistsAppServico.ListarPlaylistsDoUsuarioAsync(Id);
            quantidadePlaylists = playlists.Count;
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Erro ao carregar playlists: {ex.Message}");
        }
    }
}