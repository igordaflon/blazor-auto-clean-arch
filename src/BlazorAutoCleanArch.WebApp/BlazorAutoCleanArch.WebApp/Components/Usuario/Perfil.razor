@page "/usuario/{Id}/perfil"
@using BlazorAutoCleanArch.WebApp.Helpers
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components
@attribute [Authorize]
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<div class="profile-page">
    <!-- Header com foto de perfil e nome -->
    <div class="profile-header bg-gradient p-5">
        <div class="container-fluid px-5">
            <AuthorizeView>
                <div class="row align-items-end">
                    <div class="col-auto">
                        <img src="@GravatarHelper.ObterGravatarUrl(context.User.Identity?.Name ?? "", 400)"
                             height="200"
                             width="200"
                             class="profile-image shadow-lg rounded-circle me-2" />
                    </div>
                    <div class="col">
                        <p class="text-white-50 mb-2 small text-uppercase fw-semibold">Perfil</p>
                        <h1 class="display-3 fw-bold text-white mb-3">@context.User.Identity?.Name</h1>
                        <p class="text-white-50 mb-0">
                            <span class="fw-semibold">@playlistCount</span> playlists públicas
                        </p>
                    </div>
                </div>
            </AuthorizeView>
        </div>
    </div>

    <!-- Conteúdo principal -->
    <div class="profile-content bg-dark">
        <div class="container-fluid px-5 py-4">
            <!-- Botão criar playlist -->
            <div class="mb-4">
                <button class="btn btn-primary btn-lg rounded-pill px-4"
                        @onclick="CriarPlaylist">
                    <i class="bi bi-plus-circle me-2"></i>
                    Criar Playlist
                </button>
            </div>

            <!-- Grid de playlists -->
            <div class="playlists-section">
                <h2 class="h4 text-white mb-4">Playlists Públicas</h2>
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 row-cols-xxl-6 g-4">
                    @foreach (var playlist in playlists)
                    {
                        <div class="col">
                            <a href="@($"/playlist/{playlist.Id}")" class="text-decoration-none">
                                <div class="playlist-card bg-body-secondary rounded-3 p-3 h-100
                                                                        transition-transform">
                                    <div class="playlist-cover mb-3 position-relative">
                                        <img src="@playlist.ImageUrl"
                                             alt="@playlist.Nome"
                                             class="w-100 rounded-2 shadow" />
                                        <div class="play-button position-absolute bottom-0 end-0 m-2
                                                                                opacity-0 transition-opacity">
                                            <div class="btn btn-primary rounded-circle p-3 shadow">
                                                <i class="bi bi-play-fill fs-5"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <h3 class="h6 text-white fw-semibold mb-2 text-truncate">
                                        @playlist.Nome
                                    </h3>
                                    <p class="small text-white-50 mb-0 playlist-description">
                                        @playlist.Descricao
                                    </p>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    article.px-4 {
        padding: 0 !important;
    }

    .profile-page {
        margin: 0;
        padding: 0;
        width: 100%;
    }

    .profile-header {
        background: linear-gradient(135deg, #512bd4 0%, #8b5cf6 50%, #3b82f6 100%);
        min-height: 340px;
        display: flex;
        align-items: flex-end;
        width: 100%;
    }

    .profile-image {
        width: 232px;
        height: 232px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid rgba(255, 255, 255, 0.2);
    }

    .profile-content {
        min-height: calc(100vh - 340px);
        background: linear-gradient(180deg, rgba(81, 43, 212, 0.15) 0%, #0d1117 20%);
        width: 100%;
    }

    .playlist-card {
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        background-color: #1a1d29 !important;
    }

        .playlist-card:hover {
            background-color: #252a3a !important;
            transform: translateY(-4px);
        }

            .playlist-card:hover .play-button {
                opacity: 1 !important;
            }

    .playlist-cover {
        aspect-ratio: 1;
        overflow: hidden;
    }

        .playlist-cover img {
            object-fit: cover;
            aspect-ratio: 1;
        }

    .playlist-description {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .transition-transform {
        transition: transform 0.2s ease;
    }

    .transition-opacity {
        transition: opacity 0.3s ease;
    }

    .text-white-50 {
        color: rgba(255, 255, 255, 0.7);
    }

    .bg-body-secondary {
        background-color: #1a1d29;
    }

    .btn-primary {
        background: linear-gradient(135deg, #512bd4 0%, #8b5cf6 100%);
        border: none;
    }

        .btn-primary:hover {
            background: linear-gradient(135deg, #6d3aea 0%, #a78bfa 100%);
            transform: scale(1.04);
        }
</style>

@code {
    [Parameter]
    public string Id { get; set; } = string.Empty;

    private int playlistCount = 0;
    private List<PlaylistModel> playlists = new();

    protected override void OnInitialized()
    {
        LoadPlaylists();
    }

    private void LoadPlaylists()
    {
        // TODO: Implementar carregamento de playlists da API
        // Dados de exemplo
        playlists = new List<PlaylistModel>
        {
            new() { Id = "1", Nome = "Músicas Favoritas", Descricao = "Minhas músicas preferidas", ImageUrl = "https://picsum.photos/300/300?random=1" },
            new() { Id = "2", Nome = "Rock Clássico", Descricao = "Os melhores do rock", ImageUrl = "https://picsum.photos/300/300?random=2" },
            new() { Id = "3", Nome = "Chill Vibes", Descricao = "Para relaxar", ImageUrl = "https://picsum.photos/300/300?random=3" },
            new() { Id = "4", Nome = "Workout", Descricao = "Energia para treinar", ImageUrl = "https://picsum.photos/300/300?random=4" },
            new() { Id = "5", Nome = "Jazz Instrumental", Descricao = "Jazz suave", ImageUrl = "https://picsum.photos/300/300?random=5" },
        };

        playlistCount = playlists.Count;
    }

    private void CriarPlaylist()
    {
        NavigationManager.NavigateTo($"/usuario/{Id}/playlist/nova");
    }

    private class PlaylistModel
    {
        public string Id { get; set; }
        public string Nome { get; set; }
        public string Descricao { get; set; }
        public string ImageUrl { get; set; }
    }
}